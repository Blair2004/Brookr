(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{iQDh:function(e,t,o){"use strict";o.r(t);var n=o("8AiQ"),i=o("5/c3"),r=o("0BcZ"),c=o("1C3z"),s=o("z35L"),a=o("2pW/"),d=o("BLjT"),l=o("ryqd"),u=o("AFHi"),f=function(){return(f=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function p(e,t){if(1&e){var o=c.ec();c.dc(0,"cb-table",5),c.lc("action",(function(e){return c.Gc(o),c.pc().handleAction(e)}))("sort",(function(e){return c.Gc(o),c.pc().handleSort(e)}))("refresh",(function(e){return c.Gc(o),c.pc().handleRefresh(e)}))("page",(function(e){return c.Gc(o),c.pc().handlePagineNavigation(e)}))("search",(function(e){return c.Gc(o),c.pc().handleSearch(e)})),c.cc()}if(2&e){var n=c.pc();c.vc("is-loading",n.isLoading)("crud",n.config)}}var b=function(){function e(e,t,o,n){this.tendoo=e,this.snackbar=t,this.dialog=o,this.router=n,this.isLoading=!1,this.sort={},this.search={},this.page={},this.perPage={per_page:20}}return e.prototype.ngOnInit=function(){var e=this;this.tendoo.crud.getConfig("brookr.drivers",f(f(f(f({},this.page),this.search),this.sort),this.perPage)).subscribe((function(t){e.config=t}))},e.prototype.handleAction=function(e){var t=this;"DELETE"===e.menu.type?this.tendoo.crud.delete(e.menu.url.replace("{id}",e.row.id)).subscribe((function(o){t.snackbar.open(o.message,"OK",{duration:3e3}),t.ngOnInit(),t.dialog.getDialogById(e.menu.namespace).close()}),(function(o){t.snackbar.open(o.error.message||"An unexpected error occured","OK",{duration:5e3}),t.dialog.getDialogById(e.menu.namespace).close()})):"GOTO"===e.menu.type?this.router.navigateByUrl(e.menu.url.replace("{id}",e.row.id)):"open.payment"===e.menu.namespace&&this.dialog.open(r.a,{id:"driver-payment-popup",data:{resource:e.row,formNamespace:"brookr.advance-payment.drivers",postNamespace:"brookr/drivers/payments/"},width:[this.tendoo.responsive.isLG(),this.tendoo.responsive.isXL()].includes(!0)?"600px":"80%",height:[this.tendoo.responsive.isLG(),this.tendoo.responsive.isXL()].includes(!0)?"600px":"80%"})},e.prototype.handleSort=function(e){this.sort=e,this.ngOnInit()},e.prototype.handleSearch=function(e){this.search={search:e},this.ngOnInit()},e.prototype.handleRefresh=function(e){this.ngOnInit()},e.prototype.handlePagineNavigation=function(e){this.perPage={per_page:e.pageSize},this.page={page:e.pageIndex+1},this.ngOnInit()},e.\u0275fac=function(t){return new(t||e)(c.Xb(s.b),c.Xb(a.a),c.Xb(d.b),c.Xb(i.b))},e.\u0275cmp=c.Rb({type:e,selectors:[["app-list"]],decls:8,vars:1,consts:[[1,"mb-4","text-gray-800"],[1,"block","text-2xl","mb-2"],[1,"text-sm"],[1,"flex","w-full"],["class","w-full",3,"is-loading","crud","action","sort","refresh","page","search",4,"ngIf"],[1,"w-full",3,"is-loading","crud","action","sort","refresh","page","search"]],template:function(e,t){1&e&&(c.dc(0,"app-layout"),c.dc(1,"div",0),c.dc(2,"span",1),c.Nc(3,"Drivers"),c.cc(),c.dc(4,"p",2),c.Nc(5,"List of all created drivers"),c.cc(),c.cc(),c.dc(6,"div",3),c.Mc(7,p,1,2,"cb-table",4),c.cc(),c.cc()),2&e&&(c.Kb(7),c.vc("ngIf",t.config))},directives:[l.a,n.l,u.b],styles:[""]}),e}(),h=o("CD38"),g=o("PTmb"),v=o("t5c9"),m=o("eTQ6");function y(e,t){1&e&&(c.dc(0,"p",5),c.Nc(1,"Creating a driver"),c.cc())}function x(e,t){1&e&&(c.dc(0,"p",6),c.Nc(1,"Editing a driver"),c.cc())}function k(e,t){if(1&e){var o=c.ec();c.dc(0,"app-tabs",7),c.lc("submit",(function(e){return c.Gc(o),c.pc().handleSubmit(e)})),c.cc()}if(2&e){var n=c.pc();c.vc("form",n.form)}}var w=function(){function e(e,t,o,n,i,r){this.routeSnapshot=e,this.tendoo=t,this.client=o,this.driversService=n,this.snackbar=i,this.router=r,this.mode="create",this.id=""}return e.prototype.ngOnInit=function(){var e=this;this.routeSnapshot.paramMap.subscribe((function(t){t.get("id")&&(e.mode="edit",e.id=t.get("id")),e.generateForm()}))},e.prototype.generateForm=function(){var e=this;this.tendoo.forms.getPublicForm("brookr.drivers",+this.id>0?+this.id:void 0).subscribe((function(t){e.form=t}))},e.prototype.selectThis=function(e){this.form.sections.forEach((function(e){return e.active=!1})),e.active=!0},e.prototype.handleSubmit=function(e){var t=this;if(this.form.sections.forEach((function(e){return h.a.touchAllFields(e.formGroup)})),this.form.formGroup.invalid)return this.snackbar.open("Unable to proceed, the form is invalid","OK",{duration:3e3});this.setFieldsState("disable"),this.driversService.setDriver(this.form.formGroup.value,+this.id>0?+this.id:null).subscribe((function(e){t.setFieldsState("enable"),t.snackbar.open(e.message,"OK",{duration:3e3}),t.id||t.router.navigateByUrl("/dashboard/drivers")}),(function(e){t.snackbar.open(e.error.message||e.message||"An unexpected error has occured","OK",{duration:3e3}),t.setFieldsState("enable")}))},e.prototype.setFieldsState=function(e){this.form.sections.forEach((function(t){return h.a["disabled"===e?"deactivateFields":"enableFields"](t.fields)}))},e.\u0275fac=function(t){return new(t||e)(c.Xb(i.a),c.Xb(s.b),c.Xb(v.b),c.Xb(g.a),c.Xb(a.a),c.Xb(i.b))},e.\u0275cmp=c.Rb({type:e,selectors:[["app-manage"]],decls:7,vars:3,consts:[[1,"mb-2"],["class","text-2xl mb-2 font-serif text-gray-800",4,"ngIf"],["class","text-2xl mb-2",4,"ngIf"],[1,"text-gray-700"],[3,"form","submit",4,"ngIf"],[1,"text-2xl","mb-2","font-serif","text-gray-800"],[1,"text-2xl","mb-2"],[3,"form","submit"]],template:function(e,t){1&e&&(c.dc(0,"app-layout"),c.dc(1,"div",0),c.Mc(2,y,2,0,"p",1),c.Mc(3,x,2,0,"p",2),c.dc(4,"p",3),c.Nc(5,"Drivers can pickup and deliver loads which are assigned to them or not yet assigned."),c.cc(),c.cc(),c.Mc(6,k,1,1,"app-tabs",4),c.cc()),2&e&&(c.Kb(2),c.vc("ngIf","create"===t.mode),c.Kb(1),c.vc("ngIf","edit"===t.mode),c.Kb(3),c.vc("ngIf",t.form))},directives:[l.a,n.l,m.a],styles:[""]}),e}(),O=o("ZSGP");function G(e,t){if(1&e&&c.Yb(0,"cb-field",10),2&e){var o=t.$implicit,n=c.pc(2);c.vc("field",o)("group",n.form.sections[0].formGroup)}}function F(e,t){if(1&e&&(c.dc(0,"form",8),c.Mc(1,G,1,2,"cb-field",9),c.cc()),2&e){var o=c.pc();c.vc("formGroup",o.form.formGroup),c.Kb(1),c.vc("ngForOf",o.form.sections[0].fields)}}var I=function(){function e(e,t,o,n){this.tendoo=e,this.data=t,this.snackbar=o,this.dialogRef=n,this.load=this.data.load}return e.prototype.ngOnInit=function(){var e=this;setTimeout((function(){e.tendoo.forms.getPublicForm("broork.drivers-loads-status",e.load.id).subscribe((function(t){e.form=h.a.buildForm(t)}),(function(t){e.snackbar.open(t.error.message||t.message,"OK",{duration:3e3})}))}),0)},e.prototype.saveStatus=function(){var e=this;if(this.form.sections.forEach((function(e){return h.a.touchAllFields(e.formGroup)})),this.form.formGroup.invalid)return this.snackbar.open("Unable to proceed the form is not valid.","OK",{duration:6e3});this.form.sections.forEach((function(e){return h.a.deactivateFields(e.fields)}));var t=this.form.formGroup.value;t.load.driver_id=this.tendoo.auth.getUser().id,this.tendoo.put(this.tendoo.baseUrl+"brookr/loads/self-assign/"+this.load.id,t).subscribe((function(t){e.snackbar.open(t.message,"OK",{duration:3e3}),e.dialogRef.close(),e.ngOnInit()}),(function(t){e.snackbar.open(t.error.message,"OK",{duration:6e3}),e.form.sections.forEach((function(e){return h.a.enableFields(e.fields)}))}))},e.prototype.closeDialog=function(){this.dialogRef.close()},e.\u0275fac=function(t){return new(t||e)(c.Xb(s.b),c.Xb(d.a),c.Xb(a.a),c.Xb(d.d))},e.\u0275cmp=c.Rb({type:e,selectors:[["app-driver-load-status"]],decls:12,vars:1,consts:[[1,"h-full","w-full","flex","flex-col"],[1,"box-title","flex","flex-shrink-0","justify-center","py-4","border-b","border-gray-400","items-center","text-2xl"],[1,"flex","flex-col","flex-auto","overflow-y-auto","p-4"],["class","field container",3,"formGroup",4,"ngIf"],[1,"text-justify","p-2","bg-blue-200"],[1,"box-title","flex","flex-shrink-0","justify-end","border-t","border-gray-400","items-center","text-xl","p-2"],[1,"ml-2","bg-red-400","text-white","rounded","border","border-red-600","px-3","py-2",3,"click"],[1,"ml-2","rounded","border","border-gray-400","px-3","py-2",3,"click"],[1,"field","container",3,"formGroup"],[3,"field","group",4,"ngFor","ngForOf"],[3,"field","group"]],template:function(e,t){1&e&&(c.dc(0,"div",0),c.dc(1,"div",1),c.Nc(2,"Handle A Delivery"),c.cc(),c.dc(3,"div",2),c.Mc(4,F,2,2,"form",3),c.dc(5,"p",4),c.Nc(6,"Please make sure to select the right informations before confirming."),c.cc(),c.cc(),c.dc(7,"div",5),c.dc(8,"button",6),c.lc("click",(function(){return t.closeDialog()})),c.Nc(9,"Cancel"),c.cc(),c.dc(10,"button",7),c.lc("click",(function(){return t.saveStatus()})),c.Nc(11,"Confirm"),c.cc(),c.cc(),c.cc()),2&e&&(c.Kb(4),c.vc("ngIf",t.form))},directives:[n.l,O.t,O.n,O.h,n.k,u.d],styles:[""]}),e}();function K(e,t){if(1&e){var o=c.ec();c.dc(0,"cb-field",13),c.lc("change",(function(e){c.Gc(o);var n=t.$implicit;return c.pc(3).onFileChange(e,n)})),c.cc()}if(2&e){var n=t.$implicit,i=c.pc().$implicit;c.vc("field",n)("group",i.formGroup)}}function A(e,t){if(1&e&&(c.bc(0),c.Mc(1,K,1,2,"cb-field",12),c.ac()),2&e){var o=t.$implicit;c.Kb(1),c.vc("ngForOf",o.fields)}}function X(e,t){if(1&e&&(c.dc(0,"form",10),c.Mc(1,A,2,1,"ng-container",11),c.cc()),2&e){var o=c.pc();c.vc("formGroup",o.form.formGroup),c.Kb(1),c.vc("ngForOf",o.form.sections)}}var D=function(){function e(e,t,o,n){this.tendoo=e,this.load=t,this.snackbar=o,this.dialogRef=n,this.fieldSources={}}return e.prototype.ngOnInit=function(){var e=this;setTimeout((function(){e.tendoo.forms.getPublicForm("brookr.drivers-loads-delivery").subscribe((function(t){e.form=h.a.buildForm(t)}))}),0)},e.prototype.cancel=function(){this.dialogRef.close()},e.prototype.onFileChange=function(e,t){e.target.files.length>0&&(this.fieldSources[t.name]=e.target.files[0])},e.prototype.submitDocument=function(){var e=this,t=new FormData;if(this.form.sections.forEach((function(e){return h.a.touchAllFields(e.formGroup)})),this.form.formGroup.invalid)return this.snackbar.open("Unable to proceed the form is not valid.","OK",{duration:3e3});this.form.sections.forEach((function(o){o.fields.forEach((function(o){t.append(o.name,"file"===o.type?e.fieldSources[o.name]:o.control.value)}))})),this.tendoo.post(this.tendoo.baseUrl+"brookr/loads/stop/"+this.load.id,t).subscribe((function(t){e.dialogRef.close(),e.snackbar.open(t.message,"OK",{duration:3e3})}),(function(t){e.snackbar.open(t.error.message||t.message,"OK",{duration:3e3})}))},e.\u0275fac=function(t){return new(t||e)(c.Xb(s.b),c.Xb(d.a),c.Xb(a.a),c.Xb(d.d))},e.\u0275cmp=c.Rb({type:e,selectors:[["app-load-delivery"]],decls:16,vars:1,consts:[[1,"h-full","w-full","flex","flex-col"],[1,"header","border-b","border-gray-400","p-4","flex","justify-center","items-center","text-xl"],[1,"content","flex-auto","overflow-y-auto","p-2"],[1,"bg-gray-200","p-2"],["class","pt-2",3,"formGroup",4,"ngIf"],[1,"footer","p-2","flex","justify-between","border-t","border-gray-400"],[1,"flex"],[1,"ml-2"],[1,"outline-none","rounded","border","border-green-600","p-2","text-green-600","flex","items-center","justify-center","hover:text-white","hover:border-green-600","hover:bg-green-600",3,"click"],[1,"outline-none","rounded","border","border-red-600","text-red-600","p-2","flex","items-center","justify-center",3,"click"],[1,"pt-2",3,"formGroup"],[4,"ngFor","ngForOf"],[3,"field","group","change",4,"ngFor","ngForOf"],[3,"field","group","change"]],template:function(e,t){1&e&&(c.dc(0,"div",0),c.dc(1,"div",1),c.Nc(2," Delivery Document "),c.cc(),c.dc(3,"div",2),c.dc(4,"div",3),c.Nc(5," Uploading a document means the load has been successfully delivered. By confirming this action, the Delivery Document will be notified to the administrator. Would you like to continue ? "),c.cc(),c.Mc(6,X,2,2,"form",4),c.cc(),c.dc(7,"div",5),c.Yb(8,"div"),c.dc(9,"div",6),c.dc(10,"div",7),c.dc(11,"button",8),c.lc("click",(function(){return t.submitDocument()})),c.Nc(12," Confirm "),c.cc(),c.cc(),c.dc(13,"div",7),c.dc(14,"button",9),c.lc("click",(function(){return t.cancel()})),c.Nc(15," Cancel "),c.cc(),c.cc(),c.cc(),c.cc(),c.cc()),2&e&&(c.Kb(6),c.vc("ngIf",t.form))},directives:[n.l,O.t,O.n,O.h,n.k,u.d],styles:[""]}),e}(),S=o("4Snu"),C=function(e,t){return{"bg-gray-100":e,"bg-gray-300":t}};function L(e,t){if(1&e){var o=c.ec();c.dc(0,"div",9),c.lc("click",(function(){c.Gc(o);var e=t.$implicit;return c.pc().setTabActive(e)})),c.Nc(1),c.cc()}if(2&e){var n=t.$implicit;c.vc("ngClass",c.yc(2,C,n.active,!n.active)),c.Kb(1),c.Pc(" ",n.title," ")}}function N(e,t){if(1&e){var o=c.ec();c.dc(0,"app-table",10),c.lc("action",(function(e){return c.Gc(o),c.pc().handleAction(e)}))("refresh",(function(e){return c.Gc(o),c.pc().handleRefresh(e)}))("sort",(function(e){return c.Gc(o),c.pc().handleSort(e)}))("search",(function(e){return c.Gc(o),c.pc().handleSearch(e)})),c.cc()}if(2&e){var n=c.pc();c.vc("config",n.config)}}var T=function(){function e(e,t,o){this.tendoo=e,this.snackbar=t,this.dialog=o,this.sections=[{title:"Assigned Loads",namespace:"assigned.loads",description:"Loads assigned to your account.",active:!1,crud:this.tendoo.crud.getConfig("brookr.drivers-loads.assigned")},{title:"Unassigned Loads",namespace:"unassigned.loads",description:"Pending Loads not assigned to a driver.",active:!1,crud:this.tendoo.crud.getConfig("brookr.drivers-loads.unassigned")}]}return e.prototype.ngOnInit=function(){this.setTabActive(this.sections[0])},e.prototype.setTabActive=function(e){this.sections.forEach((function(e){return e.active=!1})),e.active=!0,this.loadActiveTabConfiguration()},e.prototype.loadActiveTabConfiguration=function(){var e=this;this.active.crud.subscribe((function(t){e.config=t}),(function(t){e.config=void 0,e.snackbar.open(t.error.message||t.error,"OK",{duration:3e3})}))},Object.defineProperty(e.prototype,"active",{get:function(){return this.sections.filter((function(e){return e.active}))[0]},enumerable:!0,configurable:!0}),e.prototype.handleRefresh=function(){this.setTabActive(this.active)},e.prototype.handleAction=function(e){var t=this;console.log(e),"handle"===e.menu.namespace?this.tendoo.get(this.tendoo.baseUrl+"brookr/drivers/is-available").subscribe((function(o){t.dialog.open(I,{id:"load-handle",data:{load:e.row},width:t.tendoo.responsive.isXL()||t.tendoo.responsive.isLG()||t.tendoo.responsive.isMD()?"600px":"80%",height:t.tendoo.responsive.isXL()||t.tendoo.responsive.isLG()||t.tendoo.responsive.isMD()?"400px":"80%"}).afterClosed().subscribe((function(e){t.setTabActive(t.active)}))}),(function(e){t.snackbar.open(e.error.message||e.message,"OK",{duration:6e3})})):"brookr.start-delivery"===e.menu.namespace?this.dialog.open(u.c,{id:"start-delivery",data:{title:"Start Delivery",message:"Would you like to start delivery now ?",buttons:[{namespace:"yes",label:"Yes",onClick:function(){t.dialog.getDialogById("start-delivery").close(),t.tendoo.get((t.tendoo.baseUrl+"brookr/loads/start/{id}").replace("{id}",e.row.id)).subscribe((function(e){t.setTabActive(t.active),t.snackbar.open(e.message,"OK",{duration:3e3})}))}},{namespace:"no",label:"No",onClick:function(){t.dialog.getDialogById("start-delivery").close()}}]}}):"brookr.send-delivery-document"===e.menu.namespace&&this.dialog.open(D,{id:"brookr.send-delivery-document",data:e.row,width:[this.tendoo.responsive.isLG(),this.tendoo.responsive.isMD(),this.tendoo.responsive.isXL()].includes(!0)?"600px":"80%",height:[this.tendoo.responsive.isLG(),this.tendoo.responsive.isMD(),this.tendoo.responsive.isXL()].includes(!0)?"600px":"80%",disableClose:!0}).afterClosed().subscribe((function(e){t.setTabActive(t.active)}))},e.\u0275fac=function(t){return new(t||e)(c.Xb(s.b),c.Xb(a.a),c.Xb(d.b))},e.\u0275cmp=c.Rb({type:e,selectors:[["app-loads"]],decls:12,vars:2,consts:[[1,"mb-4","text-gray-800"],[1,"block","text-2xl","mb-2"],[1,"text-sm"],[1,"flex","w-full","flex-col"],[1,"tab","tab-container"],[1,"tabs-header","flex",2,"margin-bottom","-2px"],["class","tab px-4 py-2 border-2 border-b-0 rounded-t-lg cursor-pointer flex items-center justify center",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"bg-gray-100","border-2"],[3,"config","action","refresh","sort","search",4,"ngIf"],[1,"tab","px-4","py-2","border-2","border-b-0","rounded-t-lg","cursor-pointer","flex","items-center","justify","center",3,"ngClass","click"],[3,"config","action","refresh","sort","search"]],template:function(e,t){1&e&&(c.dc(0,"app-layout"),c.dc(1,"div",0),c.dc(2,"span",1),c.Nc(3,"Loads"),c.cc(),c.dc(4,"p",2),c.Nc(5,"list all loads available for the drivers."),c.cc(),c.cc(),c.dc(6,"div",3),c.dc(7,"div",4),c.dc(8,"div",5),c.Mc(9,L,2,5,"div",6),c.cc(),c.cc(),c.dc(10,"div",7),c.Mc(11,N,1,1,"app-table",8),c.cc(),c.cc(),c.cc()),2&e&&(c.Kb(9),c.vc("ngForOf",t.sections),c.Kb(2),c.vc("ngIf",t.config))},directives:[l.a,n.k,n.l,n.j,S.a],styles:[""]}),e}(),M=o("/bqT"),j=[{path:"",canActivate:[M.a],component:b},{path:"create",canActivate:[M.a],component:w},{path:"edit/:id",canActivate:[M.a],component:w},{path:"loads",canActivate:[function(){function e(e,t,o){this.tendoo=e,this.snackbar=t,this.router=o}return e.prototype.canActivate=function(e,t){var o=this.tendoo.auth.getUser().role.namespace;if("brookr.driver"!==o){switch(o){case"brookr.dispatcher":case"admin":this.router.navigateByUrl("/dashboard"),this.snackbar.open("You're not allowed to see this page","OK",{duration:3e3})}return!1}return!0},e.\u0275fac=function(t){return new(t||e)(c.hc(s.b),c.hc(a.a),c.hc(i.b))},e.\u0275prov=c.Tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()],component:T}],U=function(){function e(){}return e.\u0275mod=c.Vb({type:e}),e.\u0275inj=c.Ub({factory:function(t){return new(t||e)},imports:[[i.e.forChild(j)],i.e]}),e}(),P=o("428I");o.d(t,"DriversModule",(function(){return R}));var R=function(){function e(){}return e.\u0275mod=c.Vb({type:e}),e.\u0275inj=c.Ub({factory:function(t){return new(t||e)},imports:[[n.c,U,P.a]]}),e}()}}]);